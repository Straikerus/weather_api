# weather_api
Данное приложение представляет собой агрегатор данных о температуре в указанных городах.

## Актуализация данных о погоде
Для актуализации данных о погоде в заданных городах, необходимо отправить POST запрос по адресу /api/update-cities.\
В теле запроса необходимо передать JSON с полем cities_list, значением которого является строковое представление массива
с названиями городов. В случае успеха вернётся ответ с кодом 200 и пустым телом. Если возникнет какая-либо ошибка при обновлении данных о каком-либо городе, вернётся ответ с кодом 500, содержащий json с описанием всех произошедших ошибок.\
На этом моменте хочу обратить внимание. Я решил, что будет логично, что, в случае ошибки с каким-либо городом, скрипт не должен прерывать свою работу и возвращать ответ, а должен записать ошибку и продолжить свою работу и обновить данные об остальных указанных городах, после чего отправить все произошедшие ошибки в ответе.\
**Пример тела запроса**:
```javascript
{
    "cities_list":"['novokuznetsk', 'tomsk', 'ekaterinburg']"
}
```

**Пример ответа, в случае ошибок**:
```javascript
{
    "novokuznetsk": {
        "yandex": "Cannot find weather for this city",
        "openweathermap": "API limit of calls exceeded"
    },
    "ekaterinburg":{
        "openweathermap": "API limit of calls exceeded"
    }
}
```

## Получение данных о погоде в указанном городе
Для получения данных о погоде в указанном городе, необходимо отправить GET запрос по адресу /api/get-weather.\
В запросе необходимо указать параметр city с названием города.\
В случае успеха вернётся ответ с кодом 200, содержащий json с самыми актуальными данными из базы данных по каждому источнику.\
В случае если данных о городе нет ни в одном источнике, вернётся ответ с кодом 404 и причиной ошибки в виде json.\
В случае если данных о городе нет только в некоторых источниках, вернётся ответ с кодом 200, содержащий json, в котором, для некоторых источников, будет указана причина ошибки.

**Пример ответа**:
```javascript
{
    "yandex": {"temperature": 16.0, "timestamp": 1559324186.442324},
    "openweathermap": "Cannot find weather from this source"
}
```

## Добавление новых источников данных
Для добавления нового источника данных, необходимо описать класс клиента для взаимодействия с источником данных.\
Для удобства был реализован класс **BaseClient**, в котором описан конструктор для объектов классов клиентов, а также метод для обработки ответа от источника данных, который является универсальным обработчиком ответа для работы с любым источником данных. В случае с Yandex Weather его пришлось переопределить из-за особенностей работы с Yandex.\
Каждый класс клиента обязательно должен содержать метод **handle_response**, который должен обрабатывать ответ от источника данных и возвращать словарь с полученными из ответа данными, и метод **prepare_request_params**, который получает на вход название города, для которого запрошены данные, и должен возвращать словарь с параметрами для будущего запроса к источнику данных.\
После описания класса клиента, в настройках проекта (weather_api/settings.py) необходимо добавить объект данного класса в словарь **SOURCES_DICT**. В качестве ключа необходимо использовать желаемое название для источника данных.

## Пояснения к проекту
С некоторыми источниками данных была замечена одна особенность. Названия городов не всегда совпадают. Например, в случае с городом Los-Angeles. Yandex Weather найдет погоду для данного города при указании Los-Angeles, но openweathermap найдёт погоду для данного города только при указании Los Angeles, то есть с пробелом вместо тире. Один из вариантов обработки таких городов - это пробовать сначала получить по api данные по городу с тире в названии, после чего, в случае неудачи, заменять тире на пробел и пробовать снова.\
Также для openweathermap была найдена готовая библиотека, для работы с данным api, но так как цель - это проверка навыков, я написал свой клиент.

## Запуск проекта
python manage.py runserver

## Запуск тестов
python manage.py test
